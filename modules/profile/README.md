# SaltGoat 性能分析模块

## 📋 功能概述

性能分析模块提供深度的系统性能分析和优化建议，帮助识别性能瓶颈并提供针对性的优化方案。

## 🚀 使用方法

### 基本语法
```bash
saltgoat profile analyze <type>
```

### 支持的分析类型

| 类型 | 描述 | 分析指标 |
|------|------|----------|
| `system` | 系统性能分析 | CPU使用率、内存使用率、系统负载、进程分析 |
| `nginx` | Nginx性能分析 | 服务状态、配置检查、进程数量、连接数、错误日志 |
| `mysql` | MySQL性能分析 | 服务状态、连接数、查询缓存、慢查询分析 |
| `php` | PHP性能分析 | PHP-FPM状态、内存限制、OPcache、错误日志 |
| `memory` | 内存性能分析 | 内存使用率、可用内存、交换空间、内存泄漏检查 |
| `disk` | 磁盘性能分析 | 磁盘使用率、I/O性能、大文件检查、日志大小 |
| `network` | 网络性能分析 | 连接数、延迟测试、接口状态、TIME_WAIT连接 |
| `all` | 完整性能分析 | 以上所有分析类型的综合检查 |

## 📖 使用示例

### 分析单个组件
```bash
# 分析系统性能
saltgoat profile analyze system

# 分析Nginx性能
saltgoat profile analyze nginx

# 分析MySQL性能
saltgoat profile analyze mysql

# 分析PHP性能
saltgoat profile analyze php
```

### 分析资源使用
```bash
# 分析内存性能
saltgoat profile analyze memory

# 分析磁盘性能
saltgoat profile analyze disk

# 分析网络性能
saltgoat profile analyze network
```

### 完整性能分析
```bash
# 执行完整性能分析
saltgoat profile analyze all
```

## 📊 评分系统

### 评分标准
- **90-100分**: 优秀 (绿色) - 性能表现优异
- **80-89分**: 良好 (蓝色) - 性能表现良好，有优化空间
- **70-79分**: 一般 (黄色) - 性能表现一般，建议优化
- **<70分**: 需要优化 (红色) - 性能较差，需要重点优化

### 分析结果格式
```
==========================================
[INFO] 开始<类型>性能分析...
==========================================
[INFO] <类型>性能分析结果:
----------------------------------------
[INFO] 指标1: 数值
[INFO] 指标2: 数值
----------------------------------------
[WARNING] 发现 X 个性能问题:
[ERROR]   问题描述
[INFO]    建议: 优化建议
----------------------------------------
[INFO] <类型>性能评分: XX/100
```

## 🔧 性能优化建议

### 系统性能优化
- **CPU使用率过高**: 检查CPU密集型进程，考虑优化或增加CPU资源
- **内存使用率过高**: 增加内存或优化内存使用，检查内存泄漏
- **系统负载过高**: 检查系统负载，优化进程调度

### Nginx性能优化
- **连接数过多**: 优化Nginx连接配置，增加worker_connections
- **错误日志过多**: 检查Nginx错误日志，修复配置问题
- **进程数量异常**: 检查Nginx进程配置

### MySQL性能优化
- **连接数使用率过高**: 优化MySQL连接配置，增加max_connections
- **查询缓存未启用**: 启用MySQL查询缓存以提高性能
- **慢查询过多**: 优化MySQL查询，启用慢查询日志分析

### PHP性能优化
- **内存限制过低**: 增加PHP内存限制到至少128M
- **OPcache未启用**: 启用PHP OPcache以提高性能
- **错误日志过多**: 检查PHP错误日志，修复代码问题

### 内存性能优化
- **交换空间使用**: 优化内存使用，减少交换空间使用
- **内存泄漏**: 检查高内存使用进程，优化内存使用

### 磁盘性能优化
- **磁盘使用率过高**: 清理磁盘空间或增加磁盘容量
- **I/O等待时间过长**: 优化磁盘I/O，考虑使用SSD
- **大文件过多**: 检查大文件，考虑清理或移动

### 网络性能优化
- **连接数过多**: 检查网络连接，优化连接管理
- **TIME_WAIT连接过多**: 优化TCP连接配置
- **网络延迟过高**: 检查网络连接质量

## 📁 文件结构

```
modules/profile/
├── performance-analysis.sh  # 主性能分析脚本
└── README.md               # 本文档
```

## 🔗 相关功能

- **故障诊断**: `saltgoat diagnose` - 系统故障诊断
- **版本锁定**: `saltgoat version-lock` - 软件版本管理
- **系统优化**: `saltgoat optimize` - 系统优化工具

## 📝 更新日志

- **v0.5.7** - 初始版本，支持8种分析类型
- 智能评分系统和优化建议
- 完整的性能分析摘要和趋势分析
