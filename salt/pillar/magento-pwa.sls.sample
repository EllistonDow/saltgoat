# Magento PWA 站点配置示例
# 复制为 salt/pillar/magento-pwa.sls 并替换为真实值（请勿提交明文密码到仓库）

magento_pwa:
  sites:
    pwa:
      root: /var/www/pwa
      base_url: http://pwa.magento.example.com/
      base_url_secure: https://pwa.magento.example.com/

      admin:
        frontname: admin_tattoo
        firstname: PWA
        lastname: Admin
        email: pwa@example.com
        user: pwa
        password: ChangeMePwa2025!

      crypt_key: CHANGE-ME-32-CHAR-HEX-STRING

      db:
        host: localhost
        name: pwamage
        user: pwa
        password: ChangeMeDb2025!

      timezone: America/Los_Angeles
      locale: en_US
      currency: USD

      composer:
        repo_user: your-magento-marketplace-public-key
        repo_pass: your-magento-marketplace-private-key

      opensearch:
        host: localhost
        port: 9210
        scheme: http
        index_prefix: magento2pwa
        username: doge
        password: ChangeMeSearch2025!
        timeout: 15
        enable_auth: true

      options:
        use_secure: true
        use_secure_admin: true
        use_rewrites: true
        cleanup_database: true

      node:
        ensure: true
        version: "18"
        install_yarn: true
        provider: nodesource

    services:
      install_cron: true
      configure_valkey: true
      configure_rabbitmq: true

    cms:
      home:
        identifier: pwa_home
        title: PWA Home
        store_ids:
          - 0
        template: modules/pwa/templates/cms/pwa_home.html
        force_template: true

    pwa_studio:
      enable: false
        repo: https://github.com/magento/pwa-studio.git
        branch: release/14.3.1
        target_dir: /var/www/pwa/pwa-studio
        yarn_command: "yarn install"
        build_command: "yarn build"
        env_template: packages/venia-concept/.env.dist
        # 建议使用项目根目录的 .env 作为唯一来源，脚本会自动同步到 packages/venia-concept/.env
        env_file: /var/www/pwa/pwa-studio/.env
        serve_port: 8082
        env_overrides:
          MAGENTO_BACKEND_URL: https://pwa.magento.example.com/
          MAGENTO_BACKEND_EDITION: MOS
          MAGENTO_LIVE_SEARCH_ENABLED: "false"
          MAGENTO_EXPERIENCE_PLATFORM_ENABLED: "false"
          # 设置 PWA 专用首页 Identifier，缺失时脚本会自动创建占位页面
          MAGENTO_PWA_HOME_IDENTIFIER: pwa_home
          # Showcase 分类预设（用于 GraphQL 动态填充沉浸式系列）
          MAGENTO_PWA_SHOWCASE_CATEGORY_IDS: "4,5,6"
          # 可选：自定义 Showcase 兜底内容（JSON 字符串，详见 docs/pwa-project-guide.md 4.4）
          # SALTGOAT_PWA_SHOWCASE: '{"hero":{"title":"全新首页"}}'
          # 控制 Showcase 兜底：auto=CMS 为空时启用，off=禁用（默认 off）
          # SALTGOAT_PWA_SHOWCASE_FALLBACK: auto
          CHECKOUT_BRAINTREE_TOKEN: sandbox_example_token
