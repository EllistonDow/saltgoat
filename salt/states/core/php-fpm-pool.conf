{#-
  渲染单个 PHP-FPM 池配置。上下文需提供：
    pool: {
      pool_name, listen, pm, max_children, start_servers,
      min_spare_servers, max_spare_servers, max_requests,
      process_idle_timeout, php_admin_values(dict), php_values(dict),
      slowlog, user, group, clear_env, ping_path, ping_response,
      status_path, rlimit_files, request_terminate_timeout,
      catch_workers_output, extra_settings(list), include(list),
      chroot, chdir
    }
-#}
{% set pool_cfg = pool %}
[{{ pool_cfg.pool_name }}]
user = {{ pool_cfg.user }}
group = {{ pool_cfg.group }}

listen = {{ pool_cfg.listen }}
listen.owner = {{ pool_cfg.user }}
listen.group = {{ pool_cfg.group }}
listen.mode = 0660

pm = {{ pool_cfg.pm }}
pm.max_children = {{ pool_cfg.max_children }}
{% if pool_cfg.pm == 'dynamic' %}
pm.start_servers = {{ pool_cfg.start_servers }}
pm.min_spare_servers = {{ pool_cfg.min_spare_servers }}
pm.max_spare_servers = {{ pool_cfg.max_spare_servers }}
{% elif pool_cfg.pm == 'static' %}
pm.start_servers = {{ pool_cfg.max_children }}
{% elif pool_cfg.pm == 'ondemand' %}
pm.process_idle_timeout = {{ pool_cfg.process_idle_timeout }}
{% endif %}
pm.max_requests = {{ pool_cfg.max_requests }}

ping.path = {{ pool_cfg.ping_path }}
ping.response = {{ pool_cfg.ping_response }}
pm.status_path = {{ pool_cfg.status_path }}
{% if pool_cfg.rlimit_files %}
rlimit_files = {{ pool_cfg.rlimit_files }}
{% endif %}

slowlog = {{ pool_cfg.slowlog }}
request_slowlog_timeout = 10s
request_terminate_timeout = {{ pool_cfg.request_terminate_timeout }}
catch_workers_output = {{ pool_cfg.catch_workers_output }}

{% if pool_cfg.chroot %}
chroot = {{ pool_cfg.chroot }}
{% endif %}
chdir = {{ pool_cfg.chdir }}
{% if pool_cfg.clear_env is not none %}
clear_env = {{ 'yes' if pool_cfg.clear_env else 'no' }}
{% endif %}

{% for include_file in pool_cfg.include %}
include = {{ include_file }}
{% endfor %}

{% for key, value in pool_cfg.php_admin_values.items() %}
php_admin_value[{{ key }}] = {{ value }}
{% endfor %}

{% for key, value in pool_cfg.php_values.items() %}
php_value[{{ key }}] = {{ value }}
{% endfor %}

{% for line in pool_cfg.extra_settings %}
{{ line }}
{% endfor %}
