RAILS_ENV=production
NODE_ENV=production
LOCAL_DOMAIN={{ domain }}
{% if domain %}
WEB_DOMAIN={{ domain }}
{% endif %}
LOCAL_HTTPS=true
{% set trusted_proxy = extra_env.get('TRUSTED_PROXY_IP', '127.0.0.1,::1,10.0.0.0/8,172.16.0.0/12,192.168.0.0/16') %}
TRUSTED_PROXY_IP={{ trusted_proxy }}
PORT=3000
STREAMING_CLUSTER_NUM=1
WEB_CONCURRENCY={{ extra_env.get('WEB_CONCURRENCY', 2) }}
SIDEKIQ_CONCURRENCY={{ extra_env.get('SIDEKIQ_CONCURRENCY', 5) }}
SIDEKIQ_QUEUES={{ ','.join(sidekiq_queues) }}

DB_HOST=db
DB_PORT=5432
DB_NAME={{ postgres.get('db') }}
DB_USER={{ postgres.get('user') }}
DB_PASS={{ postgres.get('password') }}
DB_POOL={{ extra_env.get('DB_POOL', 5) }}

REDIS_HOST=redis
REDIS_PORT=6379
REDIS_PASSWORD=
REDIS_URL=redis://redis:6379/0

{% set smtp_host = smtp.get('host', '') %}
{% if smtp_host %}
SMTP_SERVER={{ smtp_host }}
SMTP_PORT={{ smtp.get('port', 587) }}
SMTP_LOGIN={{ smtp.get('username', '') }}
SMTP_PASSWORD={{ smtp.get('password', '') }}
SMTP_FROM_ADDRESS={{ smtp.get('from_email', '') }}
SMTP_TLS={{ 'true' if smtp.get('tls', True) else 'false' }}
SMTP_SSL=false
SMTP_AUTH_METHOD=plain
{% else %}
SMTP_SERVER=
SMTP_PORT=25
SMTP_LOGIN=
SMTP_PASSWORD=
SMTP_FROM_ADDRESS=
SMTP_TLS=false
SMTP_SSL=false
SMTP_AUTH_METHOD=plain
{% endif %}

SINGLE_USER_MODE=false
RAILS_LOG_TO_STDOUT=true
RAILS_SERVE_STATIC_FILES=true
DEFAULT_LOCALE=en
{% for key, value in extra_env.items() %}
{% if key not in ['WEB_CONCURRENCY','SIDEKIQ_CONCURRENCY','DB_POOL','TRUSTED_PROXY_IP'] %}
{{ key }}={{ value }}
{% endif %}
{% endfor %}
