services:
  minio:
    image: {{ image }}
    container_name: minio
    restart: unless-stopped
    command:
      - server
      - /data
      - --console-address
      - :9001
    environment:
      MINIO_ROOT_USER: {{ root_user }}
      MINIO_ROOT_PASSWORD: {{ root_password }}
{% for key, value in extra_env.items() %}
      {{ key }}: {{ value }}
{% endfor %}
    volumes:
      - {{ data_dir }}:/data
    ports:
{% if bind_host %}
      - "{{ bind_host }}:{{ api_port }}:9000"
      - "{{ bind_host }}:{{ console_port }}:9001"
{% else %}
      - "{{ api_port }}:9000"
      - "{{ console_port }}:9001"
{% endif %}
{% if traefik_api.rule or traefik_console.rule %}
    labels:
      - "traefik.enable=true"
{% if traefik_api.rule %}
      - "traefik.http.routers.{{ traefik_api.router }}.rule={{ traefik_api.rule }}"
      - "traefik.http.routers.{{ traefik_api.router }}.entrypoints={{ ','.join(traefik_api.entrypoints or ['web']) }}"
      - "traefik.http.services.{{ traefik_api.service_name }}.loadbalancer.server.port=9000"
      - "traefik.http.routers.{{ traefik_api.router }}.service={{ traefik_api.service_name }}"
{% if traefik_api.tls_enabled %}
      - "traefik.http.routers.{{ traefik_api.router }}.tls=true"
{% if traefik_api.cert_resolver %}
      - "traefik.http.routers.{{ traefik_api.router }}.tls.certresolver={{ traefik_api.cert_resolver }}"
{% endif %}
{% endif %}
{% for label in traefik_api.extra_labels or [] %}
      - "{{ label }}"
{% endfor %}
{% endif %}
{% if traefik_console.rule %}
      - "traefik.http.routers.{{ traefik_console.router }}.rule={{ traefik_console.rule }}"
      - "traefik.http.routers.{{ traefik_console.router }}.entrypoints={{ ','.join(traefik_console.entrypoints or ['web']) }}"
      - "traefik.http.services.{{ traefik_console.service_name }}.loadbalancer.server.port=9001"
      - "traefik.http.routers.{{ traefik_console.router }}.service={{ traefik_console.service_name }}"
{% if traefik_console.tls_enabled %}
      - "traefik.http.routers.{{ traefik_console.router }}.tls=true"
{% if traefik_console.cert_resolver %}
      - "traefik.http.routers.{{ traefik_console.router }}.tls.certresolver={{ traefik_console.cert_resolver }}"
{% endif %}
{% endif %}
{% for label in traefik_console.extra_labels or [] %}
      - "{{ label }}"
{% endfor %}
{% endif %}
{% endif %}
    networks:
      - saltgoat-core

networks:
  saltgoat-core:
    external: true
