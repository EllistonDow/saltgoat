# SaltGoat 更新日志

## [0.5.1] - 2025-01-21

### 🔧 监控系统改进
- **自动依赖安装**: Prometheus安装时自动安装Node Exporter和Nginx Exporter
- **Nginx监控修复**: 修复Nginx Exporter安装和配置问题
- **端口检测修复**: 修复监控集成脚本中的端口检测逻辑
- **业务场景检测**: 优化智能监控的业务场景检测显示

### 🐛 错误修复
- 修复Prometheus端口检测使用netstat而非ss的问题
- 修复Nginx Exporter需要status模块的配置问题
- 修复智能监控检测结果显示格式问题
- 修复监控集成脚本中日志函数调用问题

### 📊 监控功能增强
- **完整监控链路**: Prometheus + Grafana + Node Exporter + Nginx Exporter
- **自动配置**: 监控组件自动安装和配置
- **状态检查**: 实时监控所有组件的运行状态
- **防火墙管理**: 自动配置监控端口防火墙规则

## [0.5.0] - 2025-01-21

### 🚀 重大功能更新
- **监控集成系统**: 新增完整的Prometheus和Grafana监控集成
- **防火墙自动配置**: 智能检测并配置UFW、Firewalld、iptables防火墙
- **状态管理系统**: 新增Salt状态管理功能，支持状态列表、应用和回滚
- **代码质量工具**: 集成shellcheck代码检查和shfmt代码格式化

### 🔧 监控集成功能
- **Prometheus集成**: `saltgoat monitoring prometheus` - 自动安装配置Prometheus
- **Grafana集成**: `saltgoat monitoring grafana` - 自动安装配置Grafana仪表板
- **Node Exporter**: 自动安装系统监控组件
- **智能端口配置**: 自动放行9090、3000、9100端口
- **IPv4地址显示**: 显示实际服务器IP而非localhost

### 🛡️ 防火墙管理
- **多防火墙支持**: 自动检测UFW、Firewalld、iptables
- **智能端口放行**: 自动配置监控服务端口
- **防火墙状态检查**: 实时检查端口放行状态
- **跨平台兼容**: 支持Ubuntu、CentOS、Debian等发行版

### 📊 状态管理
- **状态列表**: `saltgoat state list` - 查看所有可用状态
- **状态应用**: `saltgoat state apply <name>` - 应用特定状态
- **状态回滚**: `saltgoat state rollback <name>` - 回滚到之前状态
- **自动备份**: 应用状态前自动创建备份
- **状态检查**: 显示服务状态和配置文件状态

### 🔍 代码质量
- **代码检查**: `saltgoat lint [file]` - 使用shellcheck检查代码
- **代码格式化**: `saltgoat format [file]` - 使用shfmt格式化代码
- **安全扫描**: `saltgoat security-scan` - 完整的安全扫描分析

### 🎯 用户体验提升
- **智能帮助系统**: 新增监控集成帮助页面
- **配置一致性**: 增强跨服务器配置一致性
- **IPv4地址显示**: 所有访问地址显示实际IP
- **防火墙状态**: 实时显示防火墙配置状态

### 📋 技术改进
- **模块化设计**: 监控集成功能独立模块化
- **错误处理**: 增强错误处理和调试信息
- **路径检测**: 改进配置文件路径自动检测
- **服务检测**: 优化服务状态检测逻辑

### 🎉 新增访问地址
- **Prometheus**: http://your-server-ip:9090
- **Grafana**: http://your-server-ip:3000 (admin/admin)
- **Node Exporter**: http://your-server-ip:9100/metrics

### 📊 推荐仪表板
- Node Exporter: 1860
- Nginx: 12559
- MySQL: 7362
- Valkey: 11835

## [0.4.4] - 2025-01-21

### 🐛 重要修复
- **Nginx配置语法错误修复**: 修复了`optimize magento`功能中Nginx `gzip_types`指令的语法错误
- **智能配置检测**: 改进了对不完整Nginx配置的检测和修复逻辑
- **配置一致性增强**: 确保在不同Nginx安装环境下都能正确处理配置

### 🔧 技术改进
- **智能gzip_types处理**: 自动检测`gzip_types`是否完整，并智能修复不完整的配置
- **错误恢复机制**: 增强了配置备份和恢复功能
- **sed命令优化**: 改进了多行配置的处理逻辑，避免语法错误

### 📋 修复详情
- 修复了`nginx: [emerg] unknown directive "text/plain"`错误
- 修复了`gzip_types`指令被错误分割的问题
- 改进了配置检测逻辑，支持各种Nginx配置格式
- 增强了错误处理和调试信息

### 🎯 用户体验
- **更稳定的优化**: `saltgoat optimize magento`现在更加稳定可靠
- **更好的错误处理**: 提供更清晰的错误信息和恢复建议
- **跨平台兼容**: 支持各种Nginx安装方式和配置格式

## [0.4.3] - 2025-01-21

### 🚀 重大改进
- **Magento优化配置一致性**: 大幅改进了`optimize magento`功能的跨平台兼容性
- **自动路径检测**: 支持多种Nginx和PHP安装路径的自动检测
- **灵活配置匹配**: 使用正则表达式匹配各种配置值格式，适应不同系统环境

### 🔧 功能增强
- **Nginx配置优化**: 自动检测配置文件路径（支持`/usr/local/nginx/conf/nginx.conf`和`/etc/nginx/nginx.conf`）
- **PHP版本自动检测**: 支持PHP 8.3, 8.2, 8.1, 8.0, 7.4的自动检测和配置
- **服务名称自动识别**: 自动检测PHP-FPM服务名称和可执行文件路径
- **错误处理改进**: 提供更清晰的错误信息和调试输出

### 📋 用户体验提升
- **透明化操作**: 显示检测到的配置文件路径和服务信息
- **调试信息**: 提供详细的系统检测和配置过程信息
- **一致性保证**: 确保在不同服务器上获得相同的优化效果

### 🛠️ 技术改进
- 使用动态路径检测替代硬编码路径
- 改进的配置匹配算法，支持多种格式
- 增强的错误处理和用户反馈机制
- 更好的跨平台兼容性

## [0.4.2] - 2025-01-21

### 🔧 修复和改进
- **磁盘监控修复**: 修复了`du`命令在Salt调用中的参数解析问题，现在可以正确显示目录大小统计
- **SSL证书生成优化**: 改进了证书生成函数的错误处理和权限检查，提高稳定性
- **监控PID显示修复**: 修复了服务监控中PID获取和显示逻辑，现在可以正确显示进程信息
- **系统维护功能优化**: 将系统更新检查改为直接使用`apt`命令，避免Salt超时问题

### 🐛 错误修复
- 修复了磁盘监控中`du: invalid option -- 'r'`和`du: invalid option -- '1'`错误
- 修复了SSL证书生成时的权限和错误处理问题
- 修复了监控功能中`error: list of process IDs must follow -p`错误
- 修复了系统更新检查超时问题

### 📦 技术改进
- 将部分Salt调用改为直接系统命令，提高性能和稳定性
- 优化了错误处理机制，提供更好的用户体验
- 改进了命令参数解析，避免Shell解析问题

---

## [0.4.1] - 2025-10-21

### 🔧 修复和改进
- **templates文件夹**: 重新创建了templates文件夹，用于存放自动化任务模板
- **文档完善**: 添加了templates文件夹的详细说明文档
- **功能验证**: 确认templates功能正常工作

### 📦 新增内容
- templates/README.md - 模板文件说明文档
- 支持自动化任务模板管理
- 完善的项目结构

### 🐛 错误修复
- 修复了templates文件夹被误删的问题
- 确保所有功能模块完整

---

## [0.4.0] - 2025-10-20

### 🚀 主要更新
- **性能优化**: 大幅提升SaltGoat运行速度，减少Salt调用次数
- **警告消除**: 修复了所有Salt警告和DeprecationWarning消息
- **用户体验**: 改进了命令输出格式和错误处理

### 🔧 修复和改进
- **状态检查**: 使用`systemctl`直接检查服务状态，避免Salt调用
- **数据库管理**: 优化MySQL数据库操作，使用直接命令替代Salt模块
- **服务管理**: 改进服务重启、启动、停止等操作
- **日志权限**: 修复Salt日志权限问题

### 📦 新增内容
- 支持Percona Server 8.4优化配置
- 改进的MySQL状态检查功能
- 优化的Valkey密码管理
- 完善的错误处理机制

### 🐛 错误修复
- 修复了Salt日志权限警告
- 修复了MySQL插件加载问题
- 修复了Valkey认证问题
- 修复了服务管理中的Salt警告

---

## [0.3.0] - 2025-10-19

### 🚀 主要更新
- **Web服务器**: 完整的Nginx 1.29.1 + ModSecurity v3编译安装
- **安全测试**: 全面的ModSecurity攻击测试和模拟器
- **Salt状态**: 完整的Salt状态文件管理

### 🔧 新增功能
- Nginx 1.29.1源码编译安装
- ModSecurity v3集成
- OWASP Core Rule Set (CRS)支持
- 完整的Web服务器Salt状态文件
- ModSecurity攻击测试脚本
- 安全威胁模拟器

### 📦 技术改进
- 支持动态模块加载
- 完整的SSL/TLS配置
- 优化的Nginx配置模板
- 系统服务管理

---

## [0.2.0] - 2025-10-18

### 🚀 主要更新
- **数据库管理**: 完整的MySQL/Percona支持
- **缓存系统**: Valkey (Redis兼容)集成
- **搜索引擎**: OpenSearch支持
- **消息队列**: RabbitMQ集成

### 🔧 新增功能
- MySQL/Percona数据库管理
- Valkey缓存系统
- OpenSearch搜索引擎
- RabbitMQ消息队列
- 数据库备份和恢复
- 性能监控

### 📦 技术改进
- 优化的数据库配置
- 完整的服务管理
- 监控和日志系统
- 自动化部署

---

## [0.1.0] - 2025-10-17

### 🚀 初始版本
- **基础框架**: SaltGoat核心功能
- **服务管理**: Nginx、PHP-FPM基础支持
- **Salt集成**: 完整的Salt状态管理
- **用户界面**: 命令行工具

### 🔧 核心功能
- Salt状态文件管理
- 基础服务安装和配置
- 命令行工具界面
- 日志和监控系统
- 配置文件管理

### 📦 技术特性
- 模块化设计
- Salt原生功能
- 自动化部署
- 错误处理机制
